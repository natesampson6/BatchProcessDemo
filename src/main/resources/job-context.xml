<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:batch="http://www.springframework.org/schema/batch" xsi:schemaLocation="http://www.springframework.org/schema/batch
    http://www.springframework.org/schema/batch/spring-batch-2.2.xsd
    http://www.springframework.org/schema/context 
    http://www.springframework.org/schema/context/spring-context.xsd
    http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

    <context:component-scan base-package="com.learningsolo.springbatch.*" />

    <import resource="context.xml" />

    <bean id="transactionManager" class="org.springframework.batch.support.transaction.ResourcelessTransactionManager" />

    <batch:job id="gtnContractJob">
        <!-- Spring batch job and steps -->
        <batch:step id="xmlReadAndProcessStep">

            <batch:tasklet transaction-manager="transactionManager">

                <batch:chunk reader="xmlItemReader" writer="contractWriter" 
                    processor="contractProcessor" commit-interval="50" />

            </batch:tasklet>

            <batch:listeners>

                <batch:listener ref="stepListener" />

            </batch:listeners>

        </batch:step>
    </batch:job>

    <!-- XML file reader -->

    <bean id="xmlItemReader" 
        class="org.springframework.batch.item.xml.StaxEventItemReader">

        <property name="resource" value="classpath:sample-input-report.xml" />  <!-- change this to an xsd? -->
        <property name="unmarshaller" ref="reportMarshaller" />
        <property name="fragmentRootElementName" value="Contract" />

    </bean>

    <!-- JAXB marshaller for mapping XML element to java object -->

    <bean id="reportMarshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">

        <property name="classesToBeBound">

            <list>
                <value>com.learningsolo.springbatch.Contract</value>
            </list>

        </property>

    </bean>

    <!-- Custom writer --> <!-- Classes need to be changed, won't be the same path as listed -->
    <bean id="contractWriter" class="com.selflearning.batchprocesslesson.writer.ContractWriter"/>
    <!-- Custom reader -->
    <bean id="contractReader" class="com.selflearning.batchprocesslesson.reader.ContractReader"/>
    <!-- Step listner -->
    <bean id="stepListener" class="com.selflearning.batchprocesslesson.listener.StepListener"></bean>

    <bean id="contractProcessor" class= "com.selflearning.batchprocesslesson.processor.ContractProcessor"/>

    <bean id="contractDao" class="com.selflearning.batchprocesslesson.helper.JDBCHelper"/>

</beans>